Cached  True
Transformed  True
All in COS  False
No adaptation  False
Namespace(all_in_cos=False, batch_size=5000, cached=True, cpuonly=False, dataset='imagenet', downloadall=False, end=10000, freeze=True, freeze_idx=17, model='myvit', no_adaptation=False, num_epochs=1, sequential=False, split_choice='automatic', split_idx=100, start=0, testonly=False, transformed=True, use_intermediate=True)
Nb GPUS  2
==> Preparing data..
==> Building model..
IN SPLITTING ALGO
Recorded bandwidth: 907.2203761140119 Mbps
In _get_intermediate_outputs_and_time
Done intermediate outputs and time
Sizes  [6.02112e+05 0.00000e+00 0.00000e+00 9.07776e+06 9.07776e+06 9.07776e+06
 9.07776e+06 9.07776e+06 9.07776e+06 9.07776e+06 9.07776e+06 9.07776e+06
 9.07776e+06 9.07776e+06 9.07776e+06 3.07200e+03 3.07200e+03 3.07200e+03
 4.00000e+03]
Input_size  0.57421875
TESTING *****************************
Input size, BW, MIN:
448967248008533.3 118911189.13801576 118911189.13801576
All candidates indexes:  (array([15, 16, 17, 18]),)
SPLIT IDX CHOICE, split idx manual, freeze_idx:  automatic 100 17
Intermediate:  0.0029296875
17.314453125
Total layers size  104.47354125976562
Server, client, server+client, vanilla  902.6669921875 441.61865234375 1344.28564453125 89870.32958984375
Candidate split  16
Server, client, server+client, vanilla  902.6669921875 441.61865234375 1344.28564453125 89870.32958984375
Model size  330.2294921875
Fixed, scale_with_bsz  330.2294921875 17.888671875
Mem usage  1654.0 3.0
Using split index: 16
Freezing the lower layers of the model (myvit) till index 17
The mode is:  split
Start 0, end 5000, post_step 1000

Memory occpied: (1654.0, 3.0)
Memory occpied: (1654.0, 3.0)
Memory occpied: (1654.0, 3.0)
Memory occpied: (1654.0, 3.0)
Memory occpied: (1654.0, 3.0)
Memory occpied: (1654.0, 3.0)
Memory occpied: (1654.0, 3.0)
Memory occpied: (1654.0, 3.0)
Memory occpied: (1654.0, 3.0)
Memory occpied: (1654.0, 3.0)
Memory occpied: (1654.0, 3.0)
Memory occpied: (1654.0, 3.0)
Memory occpied: (1654.0, 3.0)
Memory occpied: (1654.0, 3.0)
Memory occpied: (1654.0, 3.0)
Memory occpied: (1654.0, 3.0)
Memory occpied: (1654.0, 3.0)
Memory occpied: (1654.0, 3.0)
Memory occpied: (1654.0, 3.0)
Memory occpied: (1654.0, 3.0)
Memory occpied: (1654.0, 3.0)
Memory occpied: (1654.0, 3.0)
Memory occpied: (1654.0, 3.0)
Memory occpied: (1654.0, 3.0)
Memory occpied: (1654.0, 3.0)
Memory occpied: (1654.0, 3.0)
Memory occpied: (1654.0, 3.0)
Memory occpied: (1654.0, 3.0)
Memory occpied: (1654.0, 3.0)
Memory occpied: (1654.0, 3.0)
Memory occpied: (1654.0, 3.0)
Read 14.813070297241211 MBs for this batch
Executing all posts took 35.637832164764404 seconds
Streaming imagenet data took 35.645503520965576 seconds
The mode is:  split
Start 5000, end 10000, post_step 1000


Epoch: 0
Time of next(dataloader) is: 0.3454115390777588
Time for copying to cuda: 0.0048220157623291016
Memory occpied: (1654.0, 15.0)
Memory occpied: (1670.0, 522.0)
Memory occpied: (1670.0, 982.0)
Time for forward pass: 3.130889892578125
Time for backpropagation: 0.07317948341369629
GPU memory for training: 1.361525058746338                          

One training iteration takes: 3.6232903003692627 seconds
Index: 0
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Memory occpied: (2430.0, 1652.0)
Read 14.813070297241211 MBs for this batch
Executing all posts took 50.0053014755249 seconds
Streaming imagenet data took 50.01316499710083 seconds
Then, training+dataloading take 50.015265464782715 seconds
The mode is:  split
Start 10000, end 15000, post_step 1000


Epoch: 0
Time of next(dataloader) is: 0.34406423568725586
Time for copying to cuda: 0.004113912582397461
Time for forward pass: 0.06639456748962402
Time for backpropagation: 0.010522127151489258
GPU memory for training: 1.3778343200683594                          

One training iteration takes: 0.5206208229064941 seconds
Index: 1
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Read 14.813070297241211 MBs for this batch
Executing all posts took 47.39997339248657 seconds
Streaming imagenet data took 47.40777039527893 seconds
Then, training+dataloading take 47.40933418273926 seconds
The mode is:  split
Start 15000, end 20000, post_step 1000


Epoch: 0
Time of next(dataloader) is: 0.3331875801086426
Time for copying to cuda: 0.00409245491027832
Time for forward pass: 0.03511452674865723
Time for backpropagation: 0.007931709289550781
GPU memory for training: 1.3778343200683594                          

One training iteration takes: 0.45851898193359375 seconds
Index: 2
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Read 14.813070297241211 MBs for this batch
Executing all posts took 49.88168382644653 seconds
Streaming imagenet data took 49.88935351371765 seconds
Then, training+dataloading take 49.89076328277588 seconds
The mode is:  split
Start 20000, end 25000, post_step 1000


Epoch: 0
Time of next(dataloader) is: 0.3676750659942627
Time for copying to cuda: 0.004128456115722656
Time for forward pass: 0.03504037857055664
Time for backpropagation: 0.007798671722412109
GPU memory for training: 1.3778343200683594                          

One training iteration takes: 0.5299558639526367 seconds
Index: 3
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Read 14.813070297241211 MBs for this batch
Executing all posts took 47.43992209434509 seconds
Streaming imagenet data took 47.44515323638916 seconds
Then, training+dataloading take 47.44654297828674 seconds
The mode is:  split
Start 25000, end 30000, post_step 1000


Epoch: 0
Time of next(dataloader) is: 0.33229637145996094
Time for copying to cuda: 0.004123210906982422
Time for forward pass: 0.0351564884185791
Time for backpropagation: 0.007945775985717773
GPU memory for training: 1.3778343200683594                          

One training iteration takes: 0.4584939479827881 seconds
Index: 4
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Read 14.813070297241211 MBs for this batch
Executing all posts took 49.97946548461914 seconds
Streaming imagenet data took 49.98438572883606 seconds
Then, training+dataloading take 49.986311197280884 seconds
The mode is:  split
Start 30000, end 32000, post_step 1000


Epoch: 0
Time of next(dataloader) is: 0.379871129989624
Time for copying to cuda: 0.004099369049072266
Time for forward pass: 0.03495430946350098
Time for backpropagation: 0.007904291152954102
GPU memory for training: 1.3778343200683594                          

Memory occpied: (2458.0, 1680.0)
One training iteration takes: 0.5079672336578369 seconds
Index: 5
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Memory occpied: (2458.0, 1680.0)
Read 5.925228118896484 MBs for this batch
Executing all posts took 23.87003517150879 seconds
Streaming imagenet data took 23.87306046485901 seconds
Then, training+dataloading take 23.87380051612854 seconds

Epoch: 0
Time of next(dataloader) is: 0.31357789039611816
Time for copying to cuda: 0.0018079280853271484
Time for forward pass: 0.03425240516662598
Time for backpropagation: 0.008007526397705078
GPU memory for training: 1.356905460357666                          

Memory occpied: (2458.0, 1680.0)
The whole process took 313.07235527038574 seconds
